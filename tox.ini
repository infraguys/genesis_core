[tox]
envlist = begin,py3{8,10,11,12,13},end
          py3{8,10,11,12,13}-functional
          ruff,ruff-check,mypy
minversion = 2.0
skipsdist = false
skip_missing_interpreters = true

[testenv]
runner = uv-venv-lock-runner
extras =
  base
  test
setenv =
  PACKAGE_NAME=genesis_core
  TEST_PATH={env:PACKAGE_NAME}/tests/unit
  functional: TEST_PATH={env:PACKAGE_NAME}/tests/functional
  functional: DATABASE_URI={env:DATABASE_URI:postgresql://genesis_core:genesis_core@127.0.0.1:5432/genesis_core}
commands =
  coverage run -p -m pytest {posargs} --timer-top-n=10 -n 10 {env:TEST_PATH}

[testenv:begin]
runner = uv-venv-lock-runner
envdir = {toxworkdir}/cover
commands =
  coverage erase

[testenv:end]
runner = uv-venv-lock-runner
envdir = {toxworkdir}/cover
commands =
  coverage combine
  coverage html -d cover
  coverage xml -o cover/coverage.xml
  coverage report --skip-covered

[testenv:ruff-check]
extras =
  ruff
runner = uv-venv-lock-runner
commands = ruff check .

[testenv:ruff]
extras =
  ruff
runner = uv-venv-lock-runner
commands = ruff format

[testenv:mypy]
extras =
  mypy
runner = uv-venv-lock-runner
commands = mypy -p genesis_core

[testenv:develop]
runner = uv-venv-lock-runner
extras =
  base
  test
usedevelop=true